<script src="dist/index.js"></script>

<head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<style style="display: block;" contenteditable="true">
    #demo {
        display: block;
        font-family: monospace;
        white-space: pre;
        overflow-x: auto;
        border: 1px solid black;
        margin: 5px;
        margin-top: 30px;
        padding: 10px;
    }

    .prompt {
        text-decoration: underline;
    }

    .ok {
        border: 1px solid green;
    }

    .wrong {
        border: 1px solid red;
    }

    input:focus {
        outline: none;
    }

    body {
        margin-bottom: 50px;
    }
</style>

</head>

<body>
<div id="container"></div>

<script id="demo">const K = Kagome;

const container = document.querySelector('#container');

K.toplevel((run) => {
    for (let i = 0;; i ++) {
        const para = run(() => K.pureS(document.createElement('p')));

        const inp = run(() => K.pureS(document.createElement('input')));
        const id = run(() => K.pureS(
            'inp-' + Math.random().toString().slice(2)));
        run(() => K.setPropertyD(inp, 'id', id));

        const label = run(() => K.pureS(document.createElement('label')));
        run(() => K.setPropertyD(label, 'innerText', `Please type ${i}: `));
        run(() => K.setPropertyD(label, 'htmlFor', id));

        run(() => K.appendChildD(para, label));
        run(() => K.appendChildD(para, inp));
        run(() => K.appendChildD(container, para));

        const prompt = run(() => K.pureS(document.createElement('p')));
        run(() => K.setPropertyD(prompt, 'className', 'prompt'));
        run(() => K.appendChildD(container, prompt));

        run(() => K.listenS(K.domEvent(inp, 'input')));

        if (inp.value !== i.toString()) {
            run(() => K.setPropertyD(inp, 'className', 'wrong'))
            if (inp.value !== '')
                run(() => K.setPropertyD(prompt, 'innerText',
                    `${inp.value} isn't right`));
            return;
        } else {
            run(() => K.setPropertyD(inp, 'className', 'ok'))
        }
    }
});
</script>
